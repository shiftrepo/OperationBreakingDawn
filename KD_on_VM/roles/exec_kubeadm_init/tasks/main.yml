---
# tasks file for install
- name: kubeadm
  shell: |-
    swapoff -a
    kubeadm init --pod-network-cidr=10.244.0.0/16
    mkdir -p $HOME/.kube
    cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
    chown $(id -u):$(id -g) $HOME/.kube/config
    echo "export KUBECONFIG=/etc/kubernetes/admin.conf" >> ${HOME}/.bash_profile
    source ${HOME}/.bash_profile
    echo Environment="KUBELET_EXTRA_ARGS=--fail-swap-on=false" >> /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
    echo Environment="KUBELET_CGROUP_ARGS=--cgroup-driver=systemd" >> /etc/systemd/system/kubelet.service.d/10-kubeadm.conf
    kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
  register: install
- debug: var=install.stdout_lines
